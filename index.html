<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>小六壬占卜</title>
  <style>
    body {
      font-family: "微軟正黑體", sans-serif;
      background-color: #f0f8ff;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      padding: 20px 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #555;
    }
    input, select {
      width: 100%;
      padding: 8px 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #007acc;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: #d9534f;
      border: 2px dashed #d9534f;
      border-radius: 4px;
    }
  </style>
  <!-- 載入從 https://github.com/isee15/Lunar-Solar-Calendar-Converter 所下載的 lunar-solar-converter.js -->
  <script src="LunarSolarConverter.js"></script>
</head>
<body>
  <div class="container">
    <h1 id="pageTitle">小六壬占卜</h1>
    <label id="langLabel" for="langSelect" style="margin-top:10px;">語言 / Language:</label>
    <select id="langSelect" style="margin-top:5px;">
      <option value="zh">中文</option>
      <option value="en">English</option>
    </select>
    <!-- 目前日期與時間的顯示區塊 -->
    <div id="currentTimeDisplay" style="text-align: center; margin-bottom: 20px; font-size: 18px;"></div>

    <form id="divinationForm">
      <label id="modeLabel" for="modeSelect">占卜模式：</label>
      <select id="modeSelect">
        <option id="optSimple" value="simple">簡答</option>
        <option id="optQuestion" value="question">問事</option>
        <option id="optAdvanced" value="advanced">深解</option>
      </select>

      <label for="questionType" id="questionLabel" style="display:none;">所問問題：</label>
      <select id="questionType" style="display:none;">
        <option id="qCareer" value="career">事業</option>
        <option id="qLove" value="love">愛情</option>
        <option id="qHealth" value="health">健康</option>
        <option id="qWealth" value="wealth">偏財運</option>
      </select>
      <label id="monthLabel" for="lunarMonth">農曆月份 (正月請填1)：</label>
      <input type="number" id="lunarMonth" min="1" max="12" required>

      <label id="dayLabel" for="lunarDay">農曆日子：</label>
      <input type="number" id="lunarDay" min="1" max="31" required>

      <label id="hourLabel" for="lunarHour">時辰 (請選擇地支)：</label>
      <select id="lunarHour" required>
        <option id="optHourPlaceholder" value="" disabled>請選擇</option>
        <option value="1">子 (23:00-01:00)</option>
        <option value="2">丑 (01:00-03:00)</option>
        <option value="3">寅 (03:00-05:00)</option>
        <option value="4">卯 (05:00-07:00)</option>
        <option value="5">辰 (07:00-09:00)</option>
        <option value="6">巳 (09:00-11:00)</option>
        <option value="7">午 (11:00-13:00)</option>
        <option value="8">未 (13:00-15:00)</option>
        <option value="9">申 (15:00-17:00)</option>
        <option value="10">酉 (17:00-19:00)</option>
        <option value="11">戌 (19:00-21:00)</option>
        <option value="12">亥 (21:00-23:00)</option>
      </select>

      <button id="submitBtn" type="submit">測算占卜</button>
    </form>
    <div id="result" class="result" style="display:none;"></div>
  </div>

  <script>
    // 定義更新日期與時間的函式
    function updateCurrentDateTime() {
      var now = new Date();
      var solarYear = now.getFullYear();
      var solarMonth = now.getMonth() + 1;
      var solarDay = now.getDate();
      var hours = now.getHours();
      var minutes = now.getMinutes();
      var seconds = now.getSeconds();
      
      // 格式化時間為 HH:MM:SS
      var formattedTime = ("0" + hours).slice(-2) + ":" +
                          ("0" + minutes).slice(-2) + ":" +
                          ("0" + seconds).slice(-2);
  
      // 透過 LunarSolarConverter 轉換國曆到農曆
      var solarObj = new Solar(solarYear, solarMonth, solarDay);
      var converter = new LunarSolarConverter();
      var lunarObj = converter.SolarToLunar(solarObj);
      var lunarYear = lunarObj.lunarYear;
      var lunarMonth = lunarObj.lunarMonth;
      var lunarDay = lunarObj.lunarDay;
      var lunarLeap = lunarObj.isleap ? (currentLang === 'en' ? ' (Leap)' : ' (閏月)') : '';

      var displayStr;
      if (currentLang === 'en') {
        displayStr = 'Solar: ' + solarYear + '/' + solarMonth + '/' + solarDay + '<br>' +
                     'Lunar: ' + lunarYear + '/' + lunarMonth + '/' + lunarDay + lunarLeap + '<br>' +
                     'Current: ' + formattedTime + '<br><hr>';
      } else {
        displayStr = '國曆： ' + solarYear + '年' + solarMonth + '月' + solarDay + '日' + '<br>' +
                     '農曆： ' + lunarYear + '年' + lunarMonth + '月' + lunarDay + '日' + lunarLeap + '<br>' +
                     '當前時刻： ' + formattedTime + '<br><hr>';
      }
      document.getElementById("currentTimeDisplay").innerHTML = displayStr;
    }
  
    // 確保 DOM 載入完成後再執行
    document.addEventListener("DOMContentLoaded", function() {
      updateCurrentDateTime();
      setInterval(updateCurrentDateTime, 1000);
    });
    
    // 六個掌訣的位置循環：大安、留連、速喜、赤口、小吉、空亡
    const cycle = ["大安", "留連", "速喜", "赤口", "小吉", "空亡"];

    const resultNameEn = {
      "大安": "Great Peace",
      "留連": "Lingering",
      "速喜": "Swift Joy",
      "赤口": "Conflict",
      "小吉": "Minor Luck",
      "空亡": "Void"
    };

    const simpleDescZh = {
      "大安": "意義： 吉利、安穩、諸事順利。\n解釋： 代表事情開始順利，運勢平穩安定。適合開始新的計畫、追求目標。如果問出行，表示平安順利；問感情，表示穩定發展；問財運，表示有小幅度的進帳或穩定。總體而言，是個好的兆頭，但仍需努力耕耘。",
      "留連": "意義： 阻礙、延遲、停滯不前。\n解釋： 表示事情進展緩慢，遇到阻礙或困境。可能會有拖延、變卦的情況發生。如果問出行，可能會有延誤或不順；問感情，表示關係停滯不前，需要耐心經營；問財運，表示投資不利或資金周轉困難。此時不宜輕舉妄動，應謹慎應對，等待時機。",
      "速喜": "意義： 喜慶、快速、好消息。\n解釋： 代表好事將近，進展快速且充滿希望。容易收到好消息，心情愉悅。如果問出行，表示順利快速到達；問感情，表示進展迅速，有機會開花結果；問財運，表示有意外之財或短期內可獲利。宜把握機會，積極行動。",
      "赤口": "意義： 口舌是非、爭執、不順利。\n解釋： 表示容易發生口角、爭執，或遇到不愉快的事情。人際關係可能出現問題，需要謹言慎行，避免衝突。如果問出行，可能會有不順或意外狀況；問感情，表示容易有爭吵或誤會；問財運，表示容易因口舌是非而破財。此時應保持冷靜，以和為貴。",
      "小吉": "意義： 小有收穫、平順、吉祥。\n解釋： 代表事情進展平穩，雖然沒有大喜大悲，但能順利達成目標，並有一些小的收穫。是個安穩祥和的局面。如果問出行，表示平安順利，但可能較為奔波；問感情，表示關係穩定，但可能缺乏激情；問財運，表示有小幅度的進帳。整體而言，是個不錯的結果。",
      "空亡": "意義： 落空、虛無、無結果。\n解釋： 表示所問之事可能沒有結果，或者期望落空。計劃難以實現，努力可能白費。如果問出行，表示不宜出行或無功而返；問感情，表示緣分較淺或難以發展；問財運，表示投資失利或沒有收益。此時應調整心態，不必過於執著，順其自然。"
    };

    const simpleDescEn = {
      "大安": "Meaning: Auspicious and stable. Explanation: Things start smoothly and luck is steady. Good for new plans or goals. Travel is safe, relationships develop steadily and finances show small or stable gains. Overall a good omen though effort is still needed.",
      "留連": "Meaning: Obstruction and delay. Explanation: Progress is slow with obstacles. Travel may be delayed, relationships stagnate and finances face difficulties. Act cautiously and wait for better timing.",
      "速喜": "Meaning: Joy and quick good news. Explanation: Good things are near with rapid progress. You may receive happy news. Travel goes quickly, relationships advance fast and money may come unexpectedly. Seize opportunities actively.",
      "赤口": "Meaning: Arguments and mishaps. Explanation: Disputes or unpleasant events are likely. Be careful with words to avoid conflict. Travel may be troubled, relationships quarrelsome and finances may suffer from disputes. Keep calm and seek harmony.",
      "小吉": "Meaning: Minor gains and smoothness. Explanation: Matters proceed steadily without major ups or downs. Goals can be reached with some small harvests. Travel is safe though busy, relationships stable but perhaps bland, finances bring small profit. A generally favorable result.",
      "空亡": "Meaning: Emptiness and no result. Explanation: Hopes may fail and plans are hard to realize. Travel is inadvisable, relationships unlikely to develop and investments may lose. Adjust your mindset and do not cling too much."
    };

    const questionDescZh = {
      "大安": {
        "career": "工作穩定順利，可能會出現新的機會或合作夥伴。適合規劃長期發展，進行穩健的投資。若有求職，有機會獲得滿意的職位。",
        "love": "感情關係穩定和諧，單身者可能遇到值得發展的對象。已婚或有伴侶者感情更加深厚。適合談婚論嫁或規劃未來。",
        "health": "身體狀況良好，精神飽滿。若有舊疾，病情趨於穩定或好轉。注意保持規律作息和健康飲食即可。",
        "wealth": "偏財運佳，可能會有一些意想不到的小收入，例如中獎、分紅、禮物等。投資方面可以嘗試一些穩健型的項目，有機會獲利。整體而言，是個偏財運不錯的時期，但切忌貪心冒進。"
      },
      "留連": {
        "career": "工作進展緩慢，遇到瓶頸或阻礙。可能會有小人作祟或內部競爭加劇。不宜輕舉妄動，保守應對為宜。若有合約或決策，需謹慎考慮，避免盲目行動。",
        "love": "感情關係停滯不前，缺乏進展。單身者難有突破，已婚或有伴侶者可能感到平淡或有隔閡。需要耐心溝通，多關心對方。",
        "health": "身體可能出現小狀況，如疲勞、精神不濟。需注意休息，避免過度勞累。舊疾可能復發或加重，需多加留意。",
        "wealth": "偏財運較差，不宜進行投機取巧的行為，容易虧損。投資方面應謹慎保守，避免高風險項目。短期內難有意外之財，宜安守本分，努力工作賺取正財。"
      },
      "速喜": {
        "career": "事業發展迅速，可能會獲得意外的機會或成功。適合積極拓展業務，勇於嘗試新事物。若有面試或提案，成功的機率較高。",
        "love": "感情進展快速，單身者容易遇到心儀的對象，且發展順利。已婚或有伴侶者感情甜蜜升溫，可能有驚喜或浪漫的事情發生。",
        "health": "身體狀況良好，精力充沛。小病痛很快就能痊癒。但要注意避免因過度興奮而忽略身體。",
        "wealth": "偏財運非常旺盛，容易獲得突如其來的財富，例如中大獎、獲得豐厚的意外之財等。投資方面眼光獨到，容易抓住機會獲利。此時宜積極把握偏財運的機會，但也要注意見好就收。"
      },
      "赤口": {
        "career": "工作中容易出現口舌是非、爭執或誤會。人際關係緊張，可能與同事或上司發生不愉快。需謹言慎行，避免捲入紛爭。決策方面容易出錯，宜三思而後行。",
        "love": "感情關係容易出現爭吵、誤會或不信任。單身者可能遇到爛桃花或被流言蜚語困擾。已婚或有伴侶者更需注意溝通方式，避免惡語傷人。",
        "health": "容易因為情緒波動而影響健康，如出現上火、口腔潰瘍等問題。注意控制情緒，保持心情平和。也要注意飲食，避免辛辣刺激的食物。",
        "wealth": "偏財運不佳，容易因為口舌是非或人際關係問題而破財。投資方面容易因聽信小道消息而做出錯誤決策，導致損失。切記不要輕易相信他人的投資建議，謹防詐騙。"
      },
      "小吉": {
        "career": "事業發展平穩順利，能達成既定目標，並獲得一些小的成就或回報。適合按部就班地工作，穩紮穩打。人際關係良好，能得到同事或貴人的幫助。",
        "love": "感情關係穩定和諧，雖然沒有太大的驚喜，但能感受到溫馨和幸福。單身者可能有機會認識新的朋友，但發展成戀人的機會不大。已婚或有伴侶者感情平淡而長久。",
        "health": "身體狀況大致良好，小病小痛很快就能恢復。注意保持健康的生活習慣即可。",
        "wealth": "偏財運平平，偶爾可能會有一些小的意外之財，但金額不大。投資方面宜選擇穩健的項目，不宜過於激進。整體而言，偏財運屬於穩定的小收益，不會有太大的驚喜。"
      },
      "空亡": {
        "career": "事業運勢低迷，所規劃的事項可能難以實現，努力付出可能沒有預期的回報。不適合進行大的投資或變動。若有合作或交易，需謹防空穴來風或虛假承諾。",
        "love": "感情方面可能沒有結果，單身者難以遇到合適的對象，即使遇到也可能無疾而終。已婚或有伴侶者感情可能趨於平淡或冷淡，缺乏激情。",
        "health": "身體狀況欠佳，容易感到疲憊、精神不振。抵抗力下降，容易生病。若有疾病，可能治療效果不佳或病情反覆。需特別注意休息和調養。",
        "wealth": "偏財運極差，幾乎沒有意外之財的機會。投資方面非常不利，容易血本無歸。切記不要抱有僥倖心理，避免任何投機行為。此時宜將重心放在正財上，努力工作才是正道。"
      }
    };

    const questionDescEn = {
      "大安": {
        "career": "Work is stable and smooth with possible new opportunities or partners. Suitable for long-term planning and steady investment. Job seekers may find satisfying positions.",
        "love": "Relationships are harmonious; singles may meet good prospects and existing couples grow closer. Good for marriage plans.",
        "health": "Generally healthy and energetic. Old illnesses stabilize or improve. Maintain regular routines and diet.",
        "wealth": "Windfall luck is good with unexpected small income. Consider conservative investments for profit but avoid greed."
      },
      "留連": {
        "career": "Progress at work is slow with obstacles or petty people. Be conservative and think carefully before making decisions or signing contracts.",
        "love": "Relationships stagnate. Singles find it hard to progress and couples may feel distant. Communicate patiently.",
        "health": "Possible minor issues like fatigue. Rest well and beware relapses of old illnesses.",
        "wealth": "Poor windfall luck. Avoid speculation and high-risk investments. Hard to gain extra money so focus on regular income."
      },
      "速喜": {
        "career": "Career develops quickly and may bring unexpected success. Actively expand business and try new things. Interviews and proposals likely succeed.",
        "love": "Relationships progress rapidly. Singles easily meet ideal partners and couples enjoy sweet surprises.",
        "health": "Good health and high energy. Minor illnesses heal fast but don't overexert yourself.",
        "wealth": "Excellent windfall luck with chances of sudden wealth. Investments are promising but remember to take profits in time."
      },
      "赤口": {
        "career": "Work may involve disputes or misunderstandings. Keep a low profile and avoid quarrels. Decisions may go wrong so think twice.",
        "love": "Arguments and mistrust are likely. Singles may meet unsuitable matches and couples should communicate carefully.",
        "health": "Emotional fluctuations could cause issues like ulcers. Control emotions and watch your diet.",
        "wealth": "Windfall luck is bad; you might lose money due to quarrels or hearsay. Don't believe rumors or scams."
      },
      "小吉": {
        "career": "Work progresses steadily and goals can be achieved with small rewards. Proceed step by step and seek help from colleagues or benefactors.",
        "love": "Relationships are stable and warm but not exciting. Singles may meet new friends without romantic development. Couples remain steady.",
        "health": "Health is generally good and minor problems recover quickly. Maintain healthy habits.",
        "wealth": "Average windfall luck with occasional small gains. Choose stable investments rather than aggressive ones."
      },
      "空亡": {
        "career": "Career luck is weak; plans are hard to realize and efforts may be wasted. Avoid major investments or changes and beware empty promises.",
        "love": "Relationships tend to have no result. Singles rarely meet suitable partners and existing relationships may cool down.",
        "health": "Poor condition with low energy and immunity. Illness may linger so rest and recuperate well.",
        "wealth": "Very poor windfall luck with almost no extra income. Investments may fail so focus on stable earnings."
      }
    };

    const advancedDescZh = {
      "大安+大安": "(研究資料中未明確提供解釋，但可推斷為極為吉祥、安定，諸事順利，可能暗示著事情的發展將會非常平穩，沒有波折)。",
      "大安+留連": "辦事可能不夠周全，遺失物品可能在西北方，婚姻之事會有所延遲 。若問尋找失物，則在中午時於南方尋找可能較易找到 。",
      "大安+速喜": "事情需要自己主動爭取，遺失物品當天可見，婚姻之事也需自己主動提出 。若問尋找失物，則在早晨於東南方尋找可能較易找到 。",
      "大安+赤口": "辦事不太順利，遺失物品不必尋找，婚姻關係可能破裂 。若問尋找失物，則在下午於西南方尋找可能較易找到 。",
      "大安+小吉": "事情會朝好的方向發展，遺失物品不會出門太遠，婚姻之事可成 。若問尋找失物，則在晚上於東方尋找可能較易找到 。",
      "大安+空亡": "(研究資料中未明確提供解釋)。若問尋找失物，則在半夜尋找困難，方位不定 。",
      "留連+大安": "辦事可能需要分開進行，婚姻方面會有喜事，但過程可能先苦後甘 。若問尋找失物，則在上午於北方尋找可能較易找到 。",
      "留連+留連": "(研究資料中未明確提供解釋)。若問尋找失物，則在傍晚於西方尋找可能較易找到 。",
      "留連+速喜": "事情需要自己努力，婚姻方面有成功的意願，遺失物品在三天內可尋回 。若問尋找失物，則在黃昏於東南方尋找可能較易找到 。",
      "留連+赤口": "病人可能會有生命危險，遺失物品難以找回，婚姻關係可能破裂 。若問尋找失物，則在深夜於西南方尋找可能較易找到 。",
      "留連+小吉": "事情不必多提，遺失物品可能在東南方，病人有望康復 。若問尋找失物，則在午夜於東方尋找可能較易找到 。",
      "留連+空亡": "病人可能會有生命危險，遺失物品難以尋獲，婚姻關係可能破裂 。若問尋找失物，則在日出之前尋找困難，方位不定 。",
      "速喜+大安": "諸事平安順利，婚姻美滿，疾病可安然度過 。若問尋找失物，則在早晨於東方尋找可能較易找到 。",
      "速喜+留連": "(研究資料中未明確提供解釋)。若問尋找失物，則在傍晚於西方尋找可能較易找到 。",
      "速喜+速喜": "(研究資料中未明確提供解釋)。若問尋找失物，則在晚上於南方尋找可能較易找到 。",
      "速喜+赤口": "需要自己主動出擊，遺失物品可能在正北方，婚姻需要積極爭取 。若問尋找失物，則在午夜於西南方尋找可能較易找到 。",
      "速喜+小吉": "婚姻方面會有人提親，病人當天可能好轉，遺失物品在家中 。若問尋找失物，則在清晨於東方尋找可能較易找到 。",
      "速喜+空亡": "婚姻可能會有變故，病人需要積極治療，遺失物品不久可見 。若問尋找失物，則在白天尋找困難，方位不定 。",
      "赤口+大安": "辦事可能充滿風險與困難，遺失物品可能在東北方，婚姻難以成功 。若問尋找失物，則在中午於北方尋找可能較易找到 。",
      "赤口+留連": "辦事會有困難，遠行之人尚未歸來，遺失物品難以找回 。若問尋找失物，則在黃昏於西方尋找可能較易找到 。",
      "赤口+速喜": "(研究資料中未明確提供解釋)。若問尋找失物，則在晚上於東南方尋找可能較易找到 。",
      "赤口+赤口": "(研究資料中未明確提供解釋)。若問尋找失物，則在深夜於南方尋找可能較易找到 。",
      "赤口+小吉": "需要自己主動提出，婚姻難以成功，沒有遺失物品的消息 。若問尋找失物，則在黎明於東方尋找可能較易找到 。",
      "赤口+空亡": "即使沒有生病也可能臥床不起，遺失物品不必尋找，婚姻難以成功 。若問尋找失物，則在日出時尋找困難，方位不定 。",
      "小吉+大安": "諸事順遂圓滿，婚姻當天可定，遺失物品是自己不慎遺失 。若問尋找失物，則在上午於北方尋找可能較易找到 。",
      "小吉+留連": "事情可能有反覆，婚姻可能有人破壞，遺失物品在西南方 。若問尋找失物，則在中午於西方尋找可能較易找到 。",
      "小吉+速喜": "事情可以重新開始，婚姻能夠成功，遺失物品在院子裡 。若問尋找失物，則在下午於東南方尋找可能較易找到 。",
      "小吉+赤口": "需要自己主動提出，婚姻難以成功，沒有遺失物品的消息 。若問尋找失物，則在黃昏於西南方尋找可能較易找到 。",
      "小吉+小吉": "(研究資料中未明確提供解釋)。若問尋找失物，則在晚上於南方尋找可能較易找到 。",
      "小吉+空亡": "病人情況不妙，遺失物品可能在正東方，婚姻之事需要再三考慮 。若問尋找失物，則在夜晚尋找困難，方位不定 。",
      "空亡+大安": "事情可能不夠周全，婚姻有望和好，遺失物品反覆出現 。若問尋找失物，則在清晨於東方尋找可能較易找到 。",
      "空亡+留連": "辦事處處受阻，婚姻需要重新決定，遺失物品永遠無法找回 。若問尋找失物，則在黎明於西方尋找可能較易找到 。",
      "空亡+速喜": "事情多是自己的過失，婚姻有成功的可能，遺失物品在家中 。若問尋找失物，則在日出時於東南方尋找可能較易找到 。",
      "空亡+赤口": "辦事可能會有官司是非，婚姻難以確定，遺失物品可能往遠處去了 。若問尋找失物，則在上午於西南方尋找可能較易找到 。",
      "空亡+小吉": "(研究資料中未明確提供解釋)。若問尋找失物，則在中午於東方尋找可能較易找到 。",
      "空亡+空亡": "(研究資料中未明確提供解釋)。若問尋找失物，則在白天尋找非常困難，方位不定 。"
    };

    const advancedDescEn = {
      "大安+大安": "Very auspicious and stable. Everything goes smoothly with no major obstacles.",
      "大安+留連": "Matters may be incomplete and delayed. Lost items could be in the northwest. Marriage will be postponed. Search to the south at noon for missing objects.",
      "大安+速喜": "You must act on your own initiative. Lost items appear the same day. Propose marriage yourself. Search southeast in the early morning.",
      "大安+赤口": "Things go poorly and lost items cannot be found. Marriage may break down. Search southwest in the afternoon.",
      "大安+小吉": "Things turn for the better. Lost items are nearby and marriage can succeed. Search east in the evening.",
      "大安+空亡": "No clear explanation. Searching at midnight is difficult with no fixed direction.",
      "留連+大安": "Matters need to be done separately. Marriage will succeed after hardship. Search north in the morning.",
      "留連+留連": "No clear explanation. Search west in the evening.",
      "留連+速喜": "Success requires your own effort. Lost items return within three days. Search southeast at dusk.",
      "留連+赤口": "The ill may be in danger and lost items are hard to find. Marriage may break. Search southwest late at night.",
      "留連+小吉": "Do not mention matters much. Lost items may be southeast and the sick will recover. Search east at midnight.",
      "留連+空亡": "The ill may be in danger and lost items difficult to find. Marriage may break. Searching before sunrise is hard with no direction.",
      "速喜+大安": "Everything is peaceful, marriage blissful and illness will pass. Search east in the morning.",
      "速喜+留連": "No clear explanation. Search west in the evening.",
      "速喜+速喜": "No clear explanation. Search south at night.",
      "速喜+赤口": "Take initiative. Lost items may be due north and marriage requires active pursuit. Search southwest at midnight.",
      "速喜+小吉": "Someone will propose marriage, the sick improve that day and lost items are at home. Search east at dawn.",
      "速喜+空亡": "Marriage may change and the ill need active treatment. Lost items will soon appear. Daytime searching is difficult with no direction.",
      "赤口+大安": "Risks and difficulties abound. Lost items may be northeast and marriage unlikely. Search north at noon.",
      "赤口+留連": "Things are difficult and travellers not yet returned. Lost items hard to find. Search west at dusk.",
      "赤口+速喜": "No clear explanation. Search southeast at night.",
      "赤口+赤口": "No clear explanation. Search south in deep night.",
      "赤口+小吉": "You must propose yourself and marriage is hard to achieve. No news on lost items. Search east at dawn.",
      "赤口+空亡": "Even the healthy may fall ill. Lost items shouldn't be sought and marriage unlikely. Searching at sunrise is difficult with no direction.",
      "小吉+大安": "Everything is smooth and marriage can be decided that day. Lost items were misplaced by yourself. Search north in the morning.",
      "小吉+留連": "Matters may fluctuate and someone may sabotage marriage. Lost items in the southwest. Search west at noon.",
      "小吉+速喜": "You can start again and marriage will succeed. Lost items in the yard. Search southeast in the afternoon.",
      "小吉+赤口": "You must take the initiative but marriage is unlikely. No news of lost items. Search southwest at dusk.",
      "小吉+小吉": "No clear explanation. Search south at night.",
      "小吉+空亡": "The patient's condition is bad and lost items may be due east. Consider marriage carefully. Searching at night is difficult with no direction.",
      "空亡+大安": "Matters may be incomplete but marriage may reconcile. Lost items reappear repeatedly. Search east at dawn.",
      "空亡+留連": "Obstacles everywhere and marriage needs reconsideration. Lost items never return. Search west at dawn.",
      "空亡+速喜": "Mostly your own fault but marriage may succeed. Lost items are at home. Search southeast at sunrise.",
      "空亡+赤口": "Possible lawsuits and uncertain marriage. Lost items may have gone far. Search southwest in the morning.",
      "空亡+小吉": "No clear explanation. Search east at noon.",
      "空亡+空亡": "No clear explanation. Searching in daytime is very hard with no direction."
    };

    const uiText = {
      zh: {
        title: "小六壬占卜",
        langLabel: "語言 / Language:",
        modeLabel: "占卜模式：",
        optSimple: "簡答",
        optQuestion: "問事",
        optAdvanced: "深解",
        questionLabel: "所問問題：",
        qCareer: "事業",
        qLove: "愛情",
        qHealth: "健康",
        qWealth: "偏財運",
        monthLabel: "農曆月份 (正月請填1)：",
        dayLabel: "農曆日子：",
        hourLabel: "時辰 (請選擇地支)：",
        hourPlaceholder: "請選擇",
        submitBtn: "測算占卜",
        resultPrefix: "占卜結果：",
        resultInitPrefix: "初始：",
        resultCurrentPrefix: "，當下：",
        alertFill: "請完整填寫所有欄位！",
        alertSelectQuestion: "請選擇所問問題類型"
      },
      en: {
        title: "Xiao Liu Ren Divination",
        langLabel: "Language:",
        modeLabel: "Mode:",
        optSimple: "Simple",
        optQuestion: "Question",
        optAdvanced: "Advanced",
        questionLabel: "Question Type:",
        qCareer: "Career",
        qLove: "Love",
        qHealth: "Health",
        qWealth: "Wealth",
        monthLabel: "Lunar Month (1 for first month):",
        dayLabel: "Lunar Day:",
        hourLabel: "Hour (choose branch):",
        hourPlaceholder: "Select",
        submitBtn: "Divine",
        resultPrefix: "Result:",
        resultInitPrefix: "First:",
        resultCurrentPrefix: ", Current:",
        alertFill: "Please complete all fields!",
        alertSelectQuestion: "Please choose a question type"
      }
    };

    let currentLang = 'zh';

    function updateLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      const t = uiText[lang];
      document.getElementById('pageTitle').innerText = t.title;
      document.getElementById('langLabel').innerText = t.langLabel;
      document.getElementById('modeLabel').innerText = t.modeLabel;
      document.getElementById('optSimple').innerText = t.optSimple;
      document.getElementById('optQuestion').innerText = t.optQuestion;
      document.getElementById('optAdvanced').innerText = t.optAdvanced;
      document.getElementById('questionLabel').innerText = t.questionLabel;
      document.getElementById('qCareer').innerText = t.qCareer;
      document.getElementById('qLove').innerText = t.qLove;
      document.getElementById('qHealth').innerText = t.qHealth;
      document.getElementById('qWealth').innerText = t.qWealth;
      document.getElementById('monthLabel').innerText = t.monthLabel;
      document.getElementById('dayLabel').innerText = t.dayLabel;
      document.getElementById('hourLabel').innerText = t.hourLabel;
      document.getElementById('optHourPlaceholder').innerText = t.hourPlaceholder;
      document.getElementById('submitBtn').innerText = t.submitBtn;
    }
    
    // 根據目前系統時間，計算所屬的中國時辰（返回 1～12）
    function getChineseHourIndex(date) {
      const h = date.getHours();
      if (h >= 23 || h < 1) return 1;
      else if (h >= 1 && h < 3) return 2;
      else if (h >= 3 && h < 5) return 3;
      else if (h >= 5 && h < 7) return 4;
      else if (h >= 7 && h < 9) return 5;
      else if (h >= 9 && h < 11) return 6;
      else if (h >= 11 && h < 13) return 7;
      else if (h >= 13 && h < 15) return 8;
      else if (h >= 15 && h < 17) return 9;
      else if (h >= 17 && h < 19) return 10;
      else if (h >= 19 && h < 21) return 11;
      else if (h >= 21 && h < 23) return 12;
    }

    // 當網頁載入完成後，自動帶入預設值
    document.addEventListener("DOMContentLoaded", function() {
      const today = new Date();

      // 使用 Lunar-Solar-Calendar-Converter 轉換國曆到農曆
      // 此函式庫提供兩個物件：Solar 和 LunarSolarConverter
      var solar = new Solar(today.getFullYear(), today.getMonth() + 1, today.getDate());
      var converter = new LunarSolarConverter();
      var lunar = converter.SolarToLunar(solar);

      // 設定預設值，注意這邊依據函式庫返回的物件屬性名稱
      document.getElementById("lunarMonth").value = lunar.lunarMonth;
      document.getElementById("lunarDay").value = lunar.lunarDay;
      
      // 設定時辰預設值：依據目前時間計算所屬的中國時辰
      const chHour = getChineseHourIndex(today);
      document.getElementById("lunarHour").value = chHour;

      const modeSelect = document.getElementById("modeSelect");
      const langSelect = document.getElementById("langSelect");
      updateLanguage(langSelect.value);
      langSelect.addEventListener('change', function(){
        updateLanguage(this.value);
      });
      const qLabel = document.getElementById("questionLabel");
      const qSelect = document.getElementById("questionType");

      modeSelect.addEventListener("change", function() {
        if (this.value === "question") {
          qLabel.style.display = "block";
          qSelect.style.display = "block";
        } else {
          qLabel.style.display = "none";
          qSelect.style.display = "none";
        }
      });

      modeSelect.dispatchEvent(new Event('change'));
    });

    document.getElementById("divinationForm").addEventListener("submit", function(e) {
      e.preventDefault();

      // 取得使用者輸入的農曆月份、日子及時辰（以地支數字表示）
      const month = parseInt(document.getElementById("lunarMonth").value);
      const day = parseInt(document.getElementById("lunarDay").value);
      const hourIndex = parseInt(document.getElementById("lunarHour").value);
      const mode = document.getElementById("modeSelect").value;
      const qType = document.getElementById("questionType").value;

      if (isNaN(month) || isNaN(day) || isNaN(hourIndex)) {
        alert(uiText[currentLang].alertFill);
        return;
      }

      // 占卜計算步驟：
      // 1. 以「大安」為起點，依農曆月份數計算出月份落點
      let monthIndex = (month - 1) % 6;
      // 2. 從月份落點開始，依日數計算出日子落點
      let dayIndex = (monthIndex + (day - 1)) % 6;
      // 3. 從日子落點開始，依時辰計算出最終結果
      let resultIndex = (dayIndex + (hourIndex - 1)) % 6;

      // 顯示占卜結果
      const resultText = cycle[resultIndex];
      const resultDiv = document.getElementById("result");
      resultDiv.style.display = "block";

      const prefix = uiText[currentLang].resultPrefix;
      const resultName = currentLang === 'en' ? resultText + ' (' + resultNameEn[resultText] + ')' : resultText;

      if (mode === "simple") {
        const desc = currentLang === 'en' ? simpleDescEn[resultText] : simpleDescZh[resultText];
        resultDiv.innerHTML = prefix + resultName + "<br>" + desc;
      } else if (mode === "question") {
        if (!qType) {
          alert(uiText[currentLang].alertSelectQuestion);
          return;
        }
        const desc = currentLang === 'en' ? questionDescEn[resultText][qType] : questionDescZh[resultText][qType];
        resultDiv.innerHTML = prefix + resultName + "<br>" + desc;
      } else {
        const firstIndex = (monthIndex + (day - 1)) % 6;
        const firstText = cycle[firstIndex];
        const key = firstText + "+" + resultText;
        const explanation = currentLang === 'en' ? (advancedDescEn[key] || '') : (advancedDescZh[key] || '');
        const firstName = currentLang === 'en' ? firstText + ' (' + resultNameEn[firstText] + ')' : firstText;
        const currentName = currentLang === 'en' ? resultText + ' (' + resultNameEn[resultText] + ')' : resultText;
        const initPrefix = uiText[currentLang].resultInitPrefix;
        const currPrefix = uiText[currentLang].resultCurrentPrefix;
        resultDiv.innerHTML = initPrefix + firstName + currPrefix + currentName + "<br>" + explanation;
      }
    });
  </script>
</body>
</html>
